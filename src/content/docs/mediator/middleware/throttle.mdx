---
title: Event Throttle
---
import { Steps } from '@astrojs/starlight/components';
import NugetBadge from '/src/components/NugetBadge.tsx';

:::note
Throttle middleware is applied only to [Events](/mediator/events)

Your handler class must be marked as partial for source generation to work correctly on the ThrottleAttribute.
:::

# Event Throttle

When publishing events rapidly (e.g. button clicks, form submissions, navigation triggers), you often want to act on the **first** event immediately but ignore subsequent duplicates for a cooldown period.  The `[Throttle]` attribute implements this true throttle pattern — the first event executes right away, then all further events within the cooldown window are discarded.

This is particularly useful for scenarios like:
- **Button clicks** — prevent double-submit by executing the first click and ignoring rapid follow-ups
- **Navigation events** — act on the first trigger immediately, ignore duplicates
- **API calls** — fire the first request instantly, suppress bursts

:::tip
If you want the **last** event in a time window instead of the **first**, use the [Sample](/mediator/middleware/sample) middleware.
:::

## Setup

<Steps>
1. Register the throttle event middleware in your host startup:
    ```csharp
    services.AddShinyMediator(cfg => cfg.AddThrottleEventMiddleware());
    ```

2. Mark your event handler method with the `[Throttle]` attribute.  The handler class **must be `partial`**:
    ```csharp
    [MediatorSingleton]
    public partial class ButtonClickHandler : IEventHandler<ButtonClickedEvent>
    {
        [Throttle(1000)] // 1000 milliseconds cooldown
        public async Task Handle(ButtonClickedEvent @event, IMediatorContext context, CancellationToken ct)
        {
            // Executes immediately on first event.
            // All events within the next 1000ms are discarded.
            await ProcessClick();
        }
    }
    ```
</Steps>

## How It Works

When an event is published and the handler has a `[Throttle]` attribute:

1. If no cooldown is active, the handler executes **immediately** and a cooldown timer starts
2. Any events published during the cooldown period are **discarded**
3. Once the cooldown expires, the next event will execute immediately again (back to step 1)

This means the first event in a burst always runs instantly, and duplicates are suppressed until the cooldown passes.

## Example — Preventing Double-Click

```csharp
public record SubmitOrderEvent(int OrderId) : IEvent;

[MediatorSingleton]
public partial class SubmitOrderHandler : IEventHandler<SubmitOrderEvent>
{
    readonly IOrderService orderService;

    public SubmitOrderHandler(IOrderService orderService)
    {
        this.orderService = orderService;
    }

    [Throttle(2000)] // 2 second cooldown after submission
    public async Task Handle(SubmitOrderEvent @event, IMediatorContext context, CancellationToken ct)
    {
        await this.orderService.Submit(@event.OrderId, ct);
    }
}
```

:::warning
If the throttle delay is set to 0 or less, the middleware will execute the handler immediately without any throttling.
:::

:::note
Each unique combination of event type and handler type has its own throttle timer.  This means different handlers for the same event type throttle independently.
:::
